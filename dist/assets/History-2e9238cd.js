import{g as j,B as le,k as A,aV as ce,c as G,ha as de,aJ as ue,bz as pe,e8 as ye,r as S,bt as me,bv as C,p as v,M as he,b_ as P,S as s,fF as ke,hZ as N,dk as L,dl as w,j as d,h_ as fe,h$ as F,al as K,dS as Se,v as Te,q as be,ak as Y,i as ge,f as Ee,u as Ce,aj as g,i0 as ve,l as Le,az as we}from"./index-12ab17f1.js";import{A as Oe}from"./ContentSection-d450bf80.js";var Re={fieldSeparator:",",decimalSeparator:".",quoteStrings:!0,quoteCharacter:'"',showTitle:!1,title:"My Generated Report",filename:"generated",showColumnHeaders:!0,useTextFile:!1,useBom:!0,columnHeaders:[],useKeysAsHeaders:!1,boolDisplay:{true:"TRUE",false:"FALSE"},replaceUndefinedWith:""},xe=`\r
`,De="\uFEFF",M=e=>Object.assign({},Re,e);class Ae extends Error{constructor(t){super(t),this.name="CsvGenerationError"}}class Ne extends Error{constructor(t){super(t),this.name="EmptyHeadersError"}}class Fe extends Error{constructor(t){super(t),this.name="CsvDownloadEnvironmentError"}}var R=e=>e,y=e=>e,x=R,O=R,B=R,_=R,Ie=function(e,t){return t=='"'&&e.indexOf('"')>-1?e.replace(/"/g,'""'):e},je=e=>B(typeof e=="object"?e.key:e),Me=e=>_(typeof e=="object"?e.displayLabel:e),Ue=(e,...t)=>t.reduce((a,r)=>r(a),e),He=e=>t=>e.useBom?x(y(t)+De):t,Ve=e=>t=>e.showTitle?x(y(t)+e.title):t,$=e=>t=>x(y(e)+y(t)+xe),W=e=>(t,a)=>qe(e)(O(t+a)),qe=e=>t=>R(y(t)+e.fieldSeparator),Pe=(e,t)=>a=>{if(!e.showColumnHeaders)return a;if(t.length<1)throw new Ne("Option to show headers but none supplied. Make sure there are keys in your collection or that you've supplied headers through the config options.");let r=O("");for(let n=0;n<t.length;n++){const i=Me(t[n]);r=W(e)(r,X(e,i))}return r=O(y(r).slice(0,-1)),$(a)(r)},Be=(e,t,a)=>r=>{let n=r;for(var i=0;i<a.length;i++){let u=O("");for(let l=0;l<t.length;l++){const p=je(t[l]),D=typeof a[i][y(p)]>"u"?e.replaceUndefinedWith:a[i][y(p)];u=W(e)(u,X(e,D))}u=O(y(u).slice(0,-1)),n=$(n)(u)}return n},z=e=>+e===e&&(!isFinite(e)||!!(e%1)),X=(e,t)=>{if(e.decimalSeparator==="locale"&&z(t))return t.toLocaleString();if(e.decimalSeparator!=="."&&z(t))return t.toString().replace(".",e.decimalSeparator);if(typeof t=="string"){let a=t;return(e.quoteStrings||e.fieldSeparator&&t.indexOf(e.fieldSeparator)>-1||e.quoteCharacter&&t.indexOf(e.quoteCharacter)>-1||t.indexOf(`
`)>-1||t.indexOf("\r")>-1)&&(a=e.quoteCharacter+Ie(t,e.quoteCharacter)+e.quoteCharacter),a}if(typeof t=="boolean"&&e.boolDisplay){const a=t?"true":"false";return e.boolDisplay[a]}return t},_e=e=>t=>{const a=M(e),r=a.useKeysAsHeaders?Object.keys(t[0]):a.columnHeaders;let n=Ue(x(""),He(a),Ve(a),Pe(a,r),Be(a,r,t));if(y(n).length<1)throw new Ae("Output is empty. Is your data formatted correctly?");return n},ze=e=>t=>{if(!window)throw new Fe("Downloading only supported in a browser environment.");const a=M(e),r=y(t),n=a.useTextFile?"plain":"csv",i=a.useTextFile?"txt":"csv";let u=new Blob([r],{type:`text/${n};charset=utf8;`}),l=document.createElement("a");l.download=`${a.filename}.${i}`,l.href=URL.createObjectURL(u),l.setAttribute("visibility","hidden"),document.body.appendChild(l),l.click(),document.body.removeChild(l)};const I=(e,t={})=>{const{filename:a="generated",showColumnHeaders:r=!0,...n}=t,i=M({showColumnHeaders:r,filename:a,...n}),u=_e(i)(e);ze(i)(u)},Ge=e=>{const t=A(ce),a=G(),r=A(de),{dydxAddress:n}=ue(),i=A(pe),{requestAllAccountFills:u,requestAllAccountTransfers:l}=ye(),[p,D]=S.useState(!0),[T,Q]=S.useState(!0),[f,Z]=S.useState(!1),{decimal:h,group:k}=me(),J=S.useCallback(async()=>{if(n&&r!==void 0){const m=(await u(n,r)).map(o=>{const b=C(o.fee,v.Fiat,{decimalSeparator:h,groupSeparator:k,selectedLocale:t}),oe=C(o.price,v.Fiat,{decimalSeparator:h,groupSeparator:k,selectedLocale:t}),ie=C(he(o.price).times(o.size),v.Fiat,{decimalSeparator:h,groupSeparator:k,selectedLocale:t}),q={[P.OrderSide.BUY]:s.BUY,[P.OrderSide.SELL]:s.SELL}[o.side];return{type:o.type,liquidity:o.liquidity,time:new Date(o.createdAt).toLocaleString(t,{dateStyle:"short",timeStyle:"short"}),amount:o.size,price:oe,fee:b,total:ie,market:o.market,side:q?a({key:q}):""}});I(m,{filename:"trades",columnHeaders:[{key:"time",displayLabel:a({key:s.TIME})},{key:"market",displayLabel:a({key:s.MARKET})},{key:"side",displayLabel:a({key:s.SIDE})},{key:"amount",displayLabel:a({key:s.AMOUNT})},{key:"price",displayLabel:a({key:s.PRICE})},{key:"total",displayLabel:a({key:s.TOTAL})},{key:"fee",displayLabel:a({key:s.FEE})},{key:"type",displayLabel:a({key:s.TYPE})},{key:"liquidity",displayLabel:a({key:s.LIQUIDITY})}]})}},[n,r,u,a,h,k,t]),ee=S.useCallback(async()=>{if(n&&r!==void 0){const m=(await l(n,r)).map(o=>{const b=C(o.size,v.Fiat,{decimalSeparator:h,groupSeparator:k,selectedLocale:t});return{time:new Date(o.createdAt).toLocaleString(t,{dateStyle:"short",timeStyle:"short"}),action:o.type,sender:o.sender.address,recipient:o.recipient.address,amount:b,transaction:o.transactionHash}});I(m,{filename:"transfers",columnHeaders:[{key:"time",displayLabel:a({key:s.TIME})},{key:"action",displayLabel:a({key:s.ACTION})},{key:"sender",displayLabel:a({key:s.TRANSFER_SENDER})},{key:"recipient",displayLabel:a({key:s.TRANSFER_RECIPIENT})},{key:"amount",displayLabel:a({key:s.AMOUNT})},{key:"transaction",displayLabel:a({key:s.TRANSACTION})}]})}},[n,r,l,a,h,k,t]),E=ke(),te=S.useCallback(async()=>{if(n&&r!==void 0&&E!=null){const c=E.map(m=>{var b;const o=C(m.amountUsdc,v.Fiat,{decimalSeparator:h,groupSeparator:k,selectedLocale:t});return{time:m.timestampMs==null?"":new Date(m.timestampMs).toLocaleString(t,{dateStyle:"short",timeStyle:"short"}),action:((b=m.type)==null?void 0:b.name)??"",amount:o,id:m.id}});I(c,{filename:"vault-transfers",columnHeaders:[{key:"time",displayLabel:a({key:s.TIME})},{key:"action",displayLabel:a({key:s.ACTION})},{key:"amount",displayLabel:a({key:s.AMOUNT})},{key:"id",displayLabel:a({key:s.TRANSACTION})}]})}},[n,r,E,a,h,k,t]),{mutate:U,isPending:ae}=N({mutationFn:J}),{mutate:H,isPending:se}=N({mutationFn:ee}),{mutate:V,isPending:re}=N({mutationFn:te}),ne=S.useCallback(c=>{c.preventDefault(),p&&U(),T&&H(),f&&V(),L(w.ExportDownloadClick({trades:p,transfers:T}))},[p,T,f,U,H,V]);return d.jsxs(fe,{onOpenChange:c=>{c&&L(w.ExportCsvClick())},items:[{label:d.jsx(F,{label:a({key:s.TRADES}),checked:p,onCheckedChange:()=>{D(!p),L(w.ExportTradesCheckboxClick({value:!p}))}}),value:"trades",onSelect:c=>c.preventDefault()},{label:d.jsx(F,{label:a({key:s.TRANSFERS}),checked:T,onCheckedChange:()=>{Q(!T),L(w.ExportTransfersCheckboxClick({value:!p}))}}),value:"transfers",onSelect:c=>c.preventDefault()},K.enableVaults&&{label:d.jsx(F,{label:a({key:s.VAULT_TRANSFERS}),checked:f,disabled:Se.isEmpty(E),onCheckedChange:()=>{Z(!f),L(w.ExportVaultTransfersCheckboxClick({value:!f}))}}),value:"vault-transfers",onSelect:c=>c.preventDefault()},{label:d.jsx(Ke,{state:{isDisabled:f&&E==null||!p&&!T&&!f,isLoading:ae||se||re},action:Te.Primary,size:be.XSmall,children:a({key:s.DOWNLOAD})}),value:"download",onSelect:ne}].filter(Y),triggerOptions:{disabled:!i},...e,children:[d.jsx(ge,{iconName:Ee.Download}),a({key:s.EXPORT})]})};var Ke=j(le).withConfig({componentId:"sc-13nrskn-0"})({width:"100%"});const Qe=()=>{const e=G(),{isNotTablet:t}=Ce(),{enableVaults:a}=K;return d.jsxs(Oe,{children:[t&&d.jsx(Ye,{orientation:"horizontal",slotAfter:d.jsx($e,{}),items:[{group:"navigation",items:[{value:g.Trades,label:d.jsx("h3",{children:e({key:s.TRADES})}),href:g.Trades},{value:g.Transfers,label:d.jsx("h3",{children:e({key:s.TRANSFERS})}),href:g.Transfers,tag:"USDC"},a&&{value:g.VaultTransfers,label:d.jsx("h3",{children:e({key:s.VAULT_TRANSFERS})}),href:g.VaultTransfers,tag:"USDC"}].filter(Y)}]}),d.jsx(ve,{})]})},Ye=j(we).withConfig({componentId:"sc-8hs84p-0"})(["--header-horizontal-padding:1rem;"," padding:1rem var(--header-horizontal-padding);h3{font-size:1.25em;}"],Le.contentSectionDetached);var $e=j(Ge).withConfig({componentId:"sc-8hs84p-1"})({marginLeft:"auto"});export{Qe as History};
